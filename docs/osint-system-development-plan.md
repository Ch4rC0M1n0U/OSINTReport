# Plan de d√©veloppement - Syst√®me de rapports OSINT complet

## üìã √âtat actuel de l'architecture

### ‚úÖ D√©j√† impl√©ment√©

**Base de donn√©es (Prisma + PostgreSQL)**
- ‚úÖ Syst√®me d'authentification complet avec JWT
- ‚úÖ Gestion des utilisateurs (User, Role, Permission)
- ‚úÖ R√©cup√©ration de mot de passe par email
- ‚úÖ Configuration SMTP dans le panel admin
- ‚úÖ Mod√®le de base pour Report avec statuts (DRAFT, PUBLISHED, ARCHIVED)
- ‚úÖ ReportModule pour structurer les rapports
- ‚úÖ Entity avec types (PERSON, ORGANIZATION, TELEPHONE, EMAIL, etc.)
- ‚úÖ ResearchRecord pour les recherches OSINT
- ‚úÖ VaultItem pour stocker les donn√©es sensibles chiffr√©es
- ‚úÖ AuditLog pour tra√ßabilit√©
- ‚úÖ ReportAttachment pour fichiers joints
- ‚úÖ ReportVersion pour historique

**Backend API**
- ‚úÖ Modules : auth, users, reports (basique), email, smtp
- ‚úÖ Middleware d'authentification
- ‚úÖ Gestion des permissions

**Frontend (Vue 3 + DaisyUI)**
- ‚úÖ Pages : Login, Register, Dashboard, Profile
- ‚úÖ Menu d'administration
- ‚úÖ Liste des rapports (basique)
- ‚úÖ Configuration SMTP

### üîß √Ä d√©velopper

**Nouveau dans le sch√©ma de donn√©es**
- üîÑ Enrichir Report avec champs sp√©cifiques police belge
- üÜï Table de corr√©lation (ReportCorrelation)
- üÜï M√©tadonn√©es pour Meilisearch (SearchableContent)

**Backend**
- üÜï API compl√®te de cr√©ation/√©dition de rapports
- üÜï Service de d√©tection de corr√©lations
- üÜï Service Meilisearch
- üÜï Service d'export PDF

**Frontend**
- üÜï Interface de cr√©ation de rapport (multi-√©tapes)
- üÜï Interface de recherche Meilisearch
- üÜï Visualisation des corr√©lations
- üÜï Pr√©visualisation et export PDF

## üéØ Phase 1 : Extension du mod√®le de donn√©es

### 1.1 Enrichissement du mod√®le Report

Le mod√®le Report actuel a d√©j√† beaucoup de champs. On va ajouter :

```prisma
model Report {
  // ... champs existants ...
  
  // Nouveaux champs sp√©cifiques
  investigationContext String?       // Contexte de l'enqu√™te
  legalBasis          String?        // Base l√©gale
  urgencyLevel        String?        // Niveau d'urgence
  classification      String?        // Classification du rapport
  keywords            String[]       // Mots-cl√©s pour recherche
  
  // Relations nouvelles
  correlations        ReportCorrelation[] @relation("SourceReport")
  correlatedBy        ReportCorrelation[] @relation("RelatedReport")
  searchableContent   SearchableContent?
}
```

### 1.2 Table de corr√©lation

D√©tecter automatiquement les liens entre rapports :

```prisma
model ReportCorrelation {
  id              String   @id @default(uuid())
  sourceReportId  String
  relatedReportId String
  correlationType String   // "PHONE", "EMAIL", "ADDRESS", "NAME", "CASE_NUMBER"
  correlationData String   // La donn√©e qui lie (ex: "+32123456789")
  confidence      Float    @default(1.0) // Score de confiance
  createdAt       DateTime @default(now())
  
  sourceReport  Report @relation("SourceReport", fields: [sourceReportId], references: [id])
  relatedReport Report @relation("RelatedReport", fields: [relatedReportId], references: [id])
  
  @@unique([sourceReportId, relatedReportId, correlationType, correlationData])
  @@index([correlationData])
  @@index([correlationType])
}
```

### 1.3 Contenu indexable pour Meilisearch

```prisma
model SearchableContent {
  id            String   @id @default(uuid())
  reportId      String   @unique
  contentHash   String   // Hash du contenu pour d√©tecter les changements
  indexedAt     DateTime @default(now())
  
  // Contenu d√©normalis√© pour Meilisearch
  fullText      String   // Tout le texte du rapport
  entities      Json     // Liste des entit√©s extraites
  metadata      Json     // M√©tadonn√©es pour filtres
  
  report Report @relation(fields: [reportId], references: [id], onDelete: Cascade)
  
  @@index([indexedAt])
}
```

## üéØ Phase 2 : Backend - API de rapports enrichie

### 2.1 Structure des endpoints

```
POST   /api/reports                    # Cr√©er un rapport
GET    /api/reports                    # Lister avec filtres/recherche
GET    /api/reports/:id                # D√©tails d'un rapport
PUT    /api/reports/:id                # Modifier un rapport
DELETE /api/reports/:id                # Supprimer (soft delete)
POST   /api/reports/:id/publish        # Publier un rapport
POST   /api/reports/:id/archive        # Archiver un rapport

# Modules du rapport
POST   /api/reports/:id/modules        # Ajouter un module
PUT    /api/reports/:id/modules/:moduleId  # Modifier un module
DELETE /api/reports/:id/modules/:moduleId  # Supprimer un module
POST   /api/reports/:id/modules/reorder    # R√©organiser les modules

# Entit√©s
POST   /api/entities                   # Cr√©er une entit√©
GET    /api/entities                   # Rechercher des entit√©s
GET    /api/entities/:id               # D√©tails d'une entit√©

# Recherches OSINT
POST   /api/reports/:id/modules/:moduleId/research  # Ajouter une recherche
PUT    /api/research/:id               # Modifier une recherche
DELETE /api/research/:id               # Supprimer une recherche

# Corr√©lations
GET    /api/reports/:id/correlations   # Obtenir les rapports li√©s
POST   /api/correlations/detect        # D√©tecter les corr√©lations manuellement
GET    /api/correlations/search        # Rechercher par donn√©e (t√©l√©phone, email, etc.)

# Export
POST   /api/reports/:id/export/pdf     # G√©n√©rer le PDF
GET    /api/reports/:id/export/pdf/:exportId  # T√©l√©charger le PDF

# Recherche globale
GET    /api/search                     # Recherche Meilisearch
GET    /api/search/suggestions         # Suggestions de recherche
```

### 2.2 Service de corr√©lation automatique

```typescript
// backend/src/modules/correlations/correlation.service.ts

class CorrelationService {
  // Extraire les donn√©es corr√©lables d'un rapport
  static async extractCorrelationData(reportId: string) {
    // Extraire : t√©l√©phones, emails, adresses, noms, num√©ros de dossier
    // Retourner une liste de donn√©es √† corr√©ler
  }
  
  // D√©tecter les corr√©lations avec d'autres rapports
  static async detectCorrelations(reportId: string) {
    const data = await this.extractCorrelationData(reportId);
    
    // Pour chaque donn√©e, chercher dans les autres rapports
    // Cr√©er des ReportCorrelation si trouv√©
    // Retourner la liste des corr√©lations d√©tect√©es
  }
  
  // Rechercher tous les rapports contenant une donn√©e sp√©cifique
  static async searchByData(data: string, type: CorrelationType) {
    // Rechercher dans ResearchRecord, Entity, etc.
  }
  
  // Obtenir le graphe de corr√©lations d'un rapport
  static async getCorrelationGraph(reportId: string, depth: number = 2) {
    // Graphe de corr√©lations (rapport central + rapports li√©s + rapports li√©s aux li√©s)
  }
}
```

## üéØ Phase 3 : Int√©gration Meilisearch

### 3.1 Configuration Docker

Ajouter dans `docker-compose.yml` :

```yaml
services:
  meilisearch:
    image: getmeili/meilisearch:v1.5
    container_name: osintreport-meilisearch
    ports:
      - "7700:7700"
    environment:
      MEILI_ENV: development
      MEILI_MASTER_KEY: ${MEILI_MASTER_KEY}
      MEILI_NO_ANALYTICS: "true"
    volumes:
      - meilisearch_data:/meili_data
    restart: unless-stopped
    networks:
      - osintreport_network

volumes:
  meilisearch_data:
```

### 3.2 Service d'indexation

```typescript
// backend/src/modules/search/meilisearch.service.ts

import { MeiliSearch } from 'meilisearch';

class MeilisearchService {
  private static client = new MeiliSearch({
    host: process.env.MEILI_HOST,
    apiKey: process.env.MEILI_MASTER_KEY,
  });
  
  // Indexer un rapport
  static async indexReport(reportId: string) {
    const report = await prisma.report.findUnique({
      where: { id: reportId },
      include: {
        owner: true,
        modules: {
          include: {
            entity: true,
            researchItems: true,
          },
        },
      },
    });
    
    // Pr√©parer le document pour Meilisearch
    const document = {
      id: report.id,
      title: report.title,
      caseNumber: report.caseNumber,
      reportNumber: report.reportNumber,
      purpose: report.purpose,
      summary: report.summary,
      status: report.status,
      owner: {
        id: report.owner.id,
        name: `${report.owner.firstName} ${report.owner.lastName}`,
      },
      issuedAt: report.issuedAt?.getTime(),
      createdAt: report.createdAt.getTime(),
      updatedAt: report.updatedAt.getTime(),
      
      // Contenu fulltext
      fullText: this.buildFullText(report),
      
      // Entit√©s extraites
      entities: report.modules
        .filter(m => m.entity)
        .map(m => ({
          label: m.entity!.label,
          type: m.entity!.type,
        })),
      
      // Mots-cl√©s
      keywords: report.keywords || [],
      
      // M√©tadonn√©es filtrables
      requestingService: report.requestingService,
      reportingUnit: report.reportingUnit,
    };
    
    // Indexer dans Meilisearch
    const index = this.client.index('reports');
    await index.addDocuments([document]);
    
    // Sauvegarder dans SearchableContent
    await prisma.searchableContent.upsert({
      where: { reportId: report.id },
      create: {
        reportId: report.id,
        contentHash: this.hashContent(document),
        fullText: document.fullText,
        entities: document.entities,
        metadata: { /* ... */ },
      },
      update: {
        contentHash: this.hashContent(document),
        fullText: document.fullText,
        entities: document.entities,
        metadata: { /* ... */ },
        indexedAt: new Date(),
      },
    });
  }
  
  // Rechercher
  static async search(query: string, filters?: any) {
    const index = this.client.index('reports');
    return await index.search(query, {
      filter: filters,
      attributesToHighlight: ['title', 'purpose', 'summary'],
      attributesToCrop: ['summary'],
      cropLength: 200,
    });
  }
  
  // Suggestions
  static async getSuggestions(query: string) {
    const index = this.client.index('reports');
    return await index.search(query, {
      limit: 5,
      attributesToRetrieve: ['title', 'caseNumber', 'reportNumber'],
    });
  }
}
```

### 3.3 Configuration de l'index Meilisearch

```typescript
// Configuration √† lancer au d√©marrage de l'app
await client.index('reports').updateSettings({
  searchableAttributes: [
    'title',
    'purpose',
    'summary',
    'fullText',
    'caseNumber',
    'reportNumber',
  ],
  filterableAttributes: [
    'status',
    'owner.id',
    'requestingService',
    'reportingUnit',
    'issuedAt',
    'createdAt',
    'entities.type',
  ],
  sortableAttributes: [
    'issuedAt',
    'createdAt',
    'updatedAt',
  ],
  rankingRules: [
    'words',
    'typo',
    'proximity',
    'attribute',
    'sort',
    'exactness',
  ],
});
```

## üéØ Phase 4 : Frontend - Interface de cr√©ation de rapport

### 4.1 Structure de l'interface (multi-√©tapes)

```
Page: /reports/new ou /reports/:id/edit

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Cr√©ation de rapport OSINT                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ [1. Informations g√©n√©rales] ‚Üí 2. Entit√©s ‚Üí 3. Modules ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚Üí 4. Recherches ‚Üí 5. R√©vision                         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ  √âtape 1 : Informations g√©n√©rales                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ Titre *          [_________________________________]‚îÇ   ‚îÇ
‚îÇ  ‚îÇ N¬∞ dossier       [_________________________________]‚îÇ   ‚îÇ
‚îÇ  ‚îÇ N¬∞ rapport       [_________________________________]‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Service demandeur [___________] ‚ñº                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Unit√© rapportante [___________] ‚ñº                   ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ P√©riode          [__/__/____] - [__/__/____]        ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ But de recherche                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [____________________________________________]       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [____________________________________________]       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Objectifs (liste)                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ [_______________________________________] [‚àí]      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ [_______________________________________] [‚àí]      ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [+ Ajouter un objectif]                              ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ Dossiers connexes                                    ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ [Rechercher un dossier...              ] [üîç]       ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Dossier #12345 - Vol aggrav√©       [√ó]            ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ ‚Ä¢ Dossier #67890 - Fraude            [√ó]            ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îÇ                                    [Suivant ‚Üí]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4.2 Composants Vue.js √† cr√©er

```
frontend/src/pages/reports/
‚îú‚îÄ‚îÄ ReportCreatePage.vue          # Page principale
‚îú‚îÄ‚îÄ ReportEditPage.vue            # √âdition
‚îú‚îÄ‚îÄ ReportViewPage.vue            # Visualisation
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ ReportWizard.vue          # Wizard multi-√©tapes
    ‚îú‚îÄ‚îÄ steps/
    ‚îÇ   ‚îú‚îÄ‚îÄ GeneralInfoStep.vue   # √âtape 1
    ‚îÇ   ‚îú‚îÄ‚îÄ EntitiesStep.vue      # √âtape 2
    ‚îÇ   ‚îú‚îÄ‚îÄ ModulesStep.vue       # √âtape 3
    ‚îÇ   ‚îú‚îÄ‚îÄ ResearchStep.vue      # √âtape 4
    ‚îÇ   ‚îî‚îÄ‚îÄ ReviewStep.vue        # √âtape 5
    ‚îú‚îÄ‚îÄ EntitySelector.vue        # S√©lecteur d'entit√©
    ‚îú‚îÄ‚îÄ ModuleEditor.vue          # √âditeur de module
    ‚îú‚îÄ‚îÄ ResearchForm.vue          # Formulaire de recherche
    ‚îú‚îÄ‚îÄ CorrelationAlert.vue      # Alerte de corr√©lation
    ‚îî‚îÄ‚îÄ RelatedReportsPanel.vue   # Panneau des rapports li√©s
```

### 4.3 D√©tection de corr√©lations en temps r√©el

Lors de la saisie d'un num√©ro de t√©l√©phone, email, etc. :

```vue
<template>
  <div class="form-control">
    <label class="label">
      <span class="label-text">Num√©ro de t√©l√©phone</span>
    </label>
    <input
      v-model="phoneNumber"
      @input="checkCorrelations"
      type="tel"
      class="input input-bordered"
      :class="{ 'input-warning': hasCorrelations }"
    />
    
    <!-- Alerte de corr√©lation -->
    <CorrelationAlert
      v-if="correlations.length > 0"
      :correlations="correlations"
      :data="phoneNumber"
      type="PHONE"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue';
import { debounce } from 'lodash-es';
import { api } from '@/services/http';

const phoneNumber = ref('');
const correlations = ref([]);
const hasCorrelations = computed(() => correlations.value.length > 0);

const checkCorrelations = debounce(async () => {
  if (phoneNumber.value.length < 8) return;
  
  try {
    const response = await api.get('/correlations/search', {
      params: {
        data: phoneNumber.value,
        type: 'PHONE',
      },
    });
    
    correlations.value = response.data.reports;
  } catch (error) {
    console.error('Erreur de v√©rification des corr√©lations', error);
  }
}, 500);
</script>
```

## üéØ Phase 5 : Export PDF

### 5.1 Service backend

```typescript
// backend/src/modules/export/pdf.service.ts

import PDFDocument from 'pdfkit';
import { createWriteStream } from 'fs';

class PdfExportService {
  static async generateReportPdf(reportId: string): Promise<string> {
    const report = await this.fetchReportData(reportId);
    
    // Cr√©er le PDF
    const doc = new PDFDocument({
      size: 'A4',
      margins: { top: 72, bottom: 72, left: 72, right: 72 },
      info: {
        Title: report.title,
        Author: `${report.owner.firstName} ${report.owner.lastName}`,
        Subject: 'Rapport OSINT',
        Keywords: report.keywords?.join(', '),
      },
    });
    
    const pdfPath = `/tmp/report-${reportId}-${Date.now()}.pdf`;
    doc.pipe(createWriteStream(pdfPath));
    
    // En-t√™te officiel
    this.addOfficialHeader(doc, report);
    
    // Contenu
    this.addGeneralInfo(doc, report);
    this.addObjectives(doc, report);
    this.addModules(doc, report);
    this.addSignature(doc, report);
    
    // Pied de page
    this.addPageNumbers(doc);
    
    doc.end();
    
    return pdfPath;
  }
  
  private static addOfficialHeader(doc: PDFKit.PDFDocument, report: any) {
    doc.image('assets/logo-police-belge.png', 50, 50, { width: 100 });
    
    doc.fontSize(16).text('POLICE F√âD√âRALE', { align: 'center' });
    doc.fontSize(14).text('RAPPORT D\'ENQU√äTE OSINT', { align: 'center' });
    doc.moveDown();
    
    doc.fontSize(10).text(`Rapport N¬∞ ${report.reportNumber || 'N/A'}`, { align: 'right' });
    doc.text(`Date : ${new Date(report.issuedAt).toLocaleDateString('fr-BE')}`, { align: 'right' });
    doc.moveDown(2);
  }
  
  private static addGeneralInfo(doc: PDFKit.PDFDocument, report: any) {
    doc.fontSize(12).text('INFORMATIONS G√âN√âRALES', { underline: true });
    doc.moveDown(0.5);
    
    doc.fontSize(10);
    doc.text(`Dossier : ${report.caseNumber || 'N/A'}`);
    doc.text(`Service demandeur : ${report.requestingService || 'N/A'}`);
    doc.text(`Unit√© rapportante : ${report.reportingUnit || 'N/A'}`);
    
    if (report.dateRangeStart && report.dateRangeEnd) {
      doc.text(`P√©riode : ${new Date(report.dateRangeStart).toLocaleDateString('fr-BE')} - ${new Date(report.dateRangeEnd).toLocaleDateString('fr-BE')}`);
    }
    
    doc.moveDown();
    doc.text('But de la recherche :', { underline: true });
    doc.text(report.purpose || 'Non sp√©cifi√©');
    doc.moveDown(2);
  }
  
  // ... autres m√©thodes
}
```

### 5.2 Template PDF professionnel

Structure du PDF g√©n√©r√© :

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  [LOGO]              POLICE F√âD√âRALE                ‚îÇ
‚îÇ              RAPPORT D'ENQU√äTE OSINT                ‚îÇ
‚îÇ                                      N¬∞ XXXX/2025   ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  INFORMATIONS G√âN√âRALES                             ‚îÇ
‚îÇ  Dossier : RN.12.3456.789                          ‚îÇ
‚îÇ  Service demandeur : Judiciaire Bruxelles          ‚îÇ
‚îÇ  Unit√© rapportante : OSINT Unit                    ‚îÇ
‚îÇ  P√©riode : 01/01/2025 - 31/01/2025                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  But de la recherche :                              ‚îÇ
‚îÇ  Identifier les personnes impliqu√©es dans...        ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  OBJECTIFS DE LA RECHERCHE                          ‚îÇ
‚îÇ  1. Identifier les num√©ros de t√©l√©phone associ√©s   ‚îÇ
‚îÇ  2. √âtablir les liens avec d'autres suspects       ‚îÇ
‚îÇ  3. Cartographier le r√©seau social                 ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ENTIT√âS CONCERN√âES                                 ‚îÇ
‚îÇ  ‚Ä¢ DUPONT Jean (Personne) - Suspect principal      ‚îÇ
‚îÇ  ‚Ä¢ +32 123 456 789 (T√©l√©phone) - Contact suspect  ‚îÇ
‚îÇ  ‚Ä¢ jean.dupont@email.be (Email) - Adresse suspecte‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  MODULE 1 : RECHERCHE T√âL√âPHONE                     ‚îÇ
‚îÇ  Entit√© : +32 123 456 789                          ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  Recherches d√©ploy√©es :                             ‚îÇ
‚îÇ  ‚Ä¢ Base de donn√©es op√©rateur (Proximus)            ‚îÇ
‚îÇ    R√©sultat : Abonn√© identifi√©, adresse confirm√©e ‚îÇ
‚îÇ  ‚Ä¢ R√©seaux sociaux (Facebook, Instagram)           ‚îÇ
‚îÇ    R√©sultat : Profil actif trouv√©, photos...      ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  [Suite des modules...]                             ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ
‚îÇ  Fait √† Bruxelles, le 02/10/2025                   ‚îÇ
‚îÇ  L'officier rapporteur,                             ‚îÇ
‚îÇ  [Signature]                                        ‚îÇ
‚îÇ  Inspecteur principal MARTIN Pierre                 ‚îÇ
‚îÇ                                              Page 1 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ Phase 6 : Interface de recherche globale

### 6.1 Page de recherche

```vue
<!-- frontend/src/pages/search/GlobalSearchPage.vue -->
<template>
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6">Recherche globale</h1>
    
    <!-- Barre de recherche -->
    <div class="form-control mb-6">
      <div class="input-group">
        <input
          v-model="searchQuery"
          @input="search"
          type="text"
          placeholder="Rechercher dans les rapports..."
          class="input input-bordered input-lg flex-1"
        />
        <button class="btn btn-square btn-lg btn-primary">
          <span class="material-symbols-rounded">search</span>
        </button>
      </div>
      
      <!-- Suggestions -->
      <div v-if="suggestions.length > 0" class="menu bg-base-200 rounded-box mt-2">
        <li v-for="suggestion in suggestions" :key="suggestion.id">
          <a @click="selectSuggestion(suggestion)">
            {{ suggestion.title }} - {{ suggestion.caseNumber }}
          </a>
        </li>
      </div>
    </div>
    
    <!-- Filtres -->
    <div class="collapse bg-base-200 mb-4">
      <input type="checkbox" />
      <div class="collapse-title font-medium">
        Filtres avanc√©s
      </div>
      <div class="collapse-content">
        <div class="grid grid-cols-3 gap-4">
          <select v-model="filters.status" class="select select-bordered">
            <option value="">Tous les statuts</option>
            <option value="DRAFT">Brouillon</option>
            <option value="PUBLISHED">Publi√©</option>
            <option value="ARCHIVED">Archiv√©</option>
          </select>
          
          <input
            v-model="filters.service"
            type="text"
            placeholder="Service demandeur"
            class="input input-bordered"
          />
          
          <input
            v-model="filters.dateFrom"
            type="date"
            class="input input-bordered"
          />
        </div>
      </div>
    </div>
    
    <!-- R√©sultats -->
    <div v-if="loading" class="flex justify-center p-8">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
    
    <div v-else-if="results.length > 0" class="space-y-4">
      <div
        v-for="result in results"
        :key="result.id"
        class="card bg-base-100 shadow hover:shadow-lg transition-shadow cursor-pointer"
        @click="viewReport(result.id)"
      >
        <div class="card-body">
          <h2 class="card-title">
            {{ result.title }}
            <div class="badge badge-primary">{{ result.status }}</div>
          </h2>
          
          <div class="text-sm text-base-content/70">
            <span v-if="result.caseNumber">Dossier : {{ result.caseNumber }}</span>
            <span v-if="result.reportNumber"> ‚Ä¢ Rapport : {{ result.reportNumber }}</span>
          </div>
          
          <p v-html="result._formatted?.summary" class="line-clamp-3"></p>
          
          <div class="card-actions justify-end items-center mt-2">
            <div class="text-xs text-base-content/60">
              {{ new Date(result.createdAt).toLocaleDateString('fr-BE') }}
            </div>
            <div class="flex gap-1">
              <div
                v-for="entity in result.entities?.slice(0, 3)"
                :key="entity.label"
                class="badge badge-sm badge-ghost"
              >
                {{ entity.label }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div v-else-if="searchQuery" class="text-center p-8 text-base-content/60">
      Aucun r√©sultat trouv√© pour "{{ searchQuery }}"
    </div>
  </div>
</template>
```

## üìÖ Planning de d√©veloppement

### Sprint 1 (5 jours) : Fondations
- [ ] Extension du sch√©ma Prisma (Report, Correlation, SearchableContent)
- [ ] Migrations de base de donn√©es
- [ ] Configuration Meilisearch dans Docker
- [ ] API basique de cr√©ation de rapport

### Sprint 2 (5 jours) : Corr√©lations
- [ ] Service de d√©tection de corr√©lations
- [ ] API de recherche de corr√©lations
- [ ] Tests de corr√©lation automatique
- [ ] Documentation API

### Sprint 3 (7 jours) : Interface de cr√©ation
- [ ] Composant wizard multi-√©tapes
- [ ] Formulaires de chaque √©tape
- [ ] Gestion des entit√©s et modules
- [ ] Int√©gration API

### Sprint 4 (5 jours) : Meilisearch
- [ ] Service d'indexation backend
- [ ] Hooks d'indexation automatique
- [ ] API de recherche
- [ ] Interface de recherche frontend

### Sprint 5 (5 jours) : Export PDF
- [ ] Service d'export PDF
- [ ] Template professionnel police belge
- [ ] Pr√©visualisation frontend
- [ ] Download s√©curis√©

### Sprint 6 (3 jours) : Polish & Tests
- [ ] Tests end-to-end
- [ ] Correction de bugs
- [ ] Documentation utilisateur
- [ ] D√©ploiement

## üöÄ Technologies utilis√©es

**Backend**
- Node.js + TypeScript
- Express.js
- Prisma ORM
- PostgreSQL
- Meilisearch client
- PDFKit ou Puppeteer
- Nodemailer

**Frontend**
- Vue 3 (Composition API)
- TypeScript
- Vue Router
- Pinia (state management)
- DaisyUI + Tailwind CSS
- Vite

**Infrastructure**
- Docker + Docker Compose
- PostgreSQL 16
- Meilisearch 1.5

## üìù Notes importantes

1. **S√©curit√©** : Les donn√©es sensibles (t√©l√©phones, emails) doivent √™tre chiffr√©es via VaultItem
2. **RGPD** : Pr√©voir l'anonymisation et la suppression des donn√©es
3. **Performance** : Index PostgreSQL sur les champs de corr√©lation
4. **Audit** : Logger toutes les actions importantes dans AuditLog
5. **Versionning** : Utiliser ReportVersion pour l'historique

---

**Date de cr√©ation** : 2 octobre 2025  
**Version** : 1.0.0  
**Auteur** : GitHub Copilot
